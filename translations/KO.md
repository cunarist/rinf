> ì˜ì–´ ì´ì™¸ì˜ ì–¸ì–´ë¡œ ëœ ë¬¸ì„œì—ì„œëŠ” ë¬¸ì¥ì´ ì–´ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¸ì„œ ê°œì„ ì— ê¸°ì—¬í•˜ê³  ì‹¶ìœ¼ì‹  ë¶„ì€ [Pull request](https://github.com/cunarist/rust-in-flutter/pulls)ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”. ì–¸ì œë‚˜ ë„ì›€ì— ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.

[![Pub Version (including pre-releases)](https://img.shields.io/pub/v/rust_in_flutter)](https://pub.dev/packages/rust_in_flutter)
[![Pub Popularity](https://img.shields.io/pub/popularity/rust_in_flutter?label=Pub%20Popularity)](https://pub.dev/packages/rust_in_flutter)
[![Pub Points](https://img.shields.io/pub/points/rust_in_flutter?label=Pub%20Points)](https://pub.dev/packages/rust_in_flutter)

![GitHub stars](https://img.shields.io/github/stars/cunarist/rust-in-flutter)
[![Build Test](https://img.shields.io/github/actions/workflow/status/cunarist/rust-in-flutter/ci.yaml)](https://github.com/cunarist/rust-in-flutter/actions/workflows/ci.yaml)
[![GitHub License](https://img.shields.io/github/license/cunarist/rust-in-flutter)](./LICENSE)

# ğŸ† Rust-In-Flutter

Rustë¥¼ í™œìš©í•´ì„œ Flutter ì•±ì˜ ì†ë„ë¥¼ ê·¹ì ìœ¼ë¡œ í–¥ìƒì‹œì¼œ ë³´ì„¸ìš”!

![preview](https://github.com/cunarist/rust-in-flutter/assets/66480156/be85cf04-2240-497f-8d0d-803c40536d8e)

ë¯¼ê°í•œ ë¹Œë“œ íŒŒì¼ì„ ê±´ë“œë¦´ í•„ìš”ë„ ì—†ê³ , ë²ˆê±°ë¡œìš´ ì½”ë“œ ìƒì„± ì ˆì°¨ë„ ì—†ìŠµë‹ˆë‹¤.

ì´ ê°„ë‹¨í•œ í”„ë ˆì„ì›Œí¬ëŠ” ê°€ë²¼ìš°ë©´ì„œë„ ì‚¬ìš©í•˜ê¸° ì‰½ê³ , í™•ì¥ì„±ê³¼ ì„±ëŠ¥ì„ ëª¨ë‘ ê³ ë ¤í•˜ì—¬ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ë³µì¡í•œ ì¼ë“¤ì€ ëª¨ë‘ ë‚´ë¶€ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤. Flutter í”„ë¡œì íŠ¸ì— ì´ íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€í•˜ê¸°ë§Œ í•˜ë©´ Rust ì½”ë“œë¥¼ ë°”ë¡œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## í”Œë«í¼ ì§€ì›

ë³µì¡í•œ ë¹Œë“œ ì„¤ì •ë“¤ì€ ëª¨ë‘ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

| Dev OS  | Linux | Android | Windows | macOS | iOS | Web |
| ------- | ----- | ------- | ------- | ----- | --- | --- |
| Linux   | âœ…    | -       | âœ…      | -     | -   | âœ…  |
| Windows | âœ…    | -       | -       | -     | âœ…  | âœ…  |
| macOS   | âœ…    | âœ…      | -       | âœ…    | -   | âœ…  |

## í˜œíƒ

- Rustë¥¼ Flutterì— í†µí•©í•˜ê³  ì›í•˜ëŠ” ë§Œí¼ì˜ Crateë¥¼ ì‚¬ìš© ê°€ëŠ¥í•¨
- Blocking ì—†ëŠ” ë¹„ë™ê¸° ìƒí˜¸ì‘ìš©
- ì†ì‰¬ìš´ Dartë¡œë¶€í„°ì˜ ìš”ì²­ê³¼ Rustì—ì„œì˜ ì‘ë‹µìœ¼ë¡œ ì´ë£¨ì–´ì§„ RESTful API
- Rustì—ì„œ Dartë¡œì˜ ìŠ¤íŠ¸ë¦¬ë°
- Dartì˜ Hot restart ì‹œ ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë˜ëŠ” Rust ë¡œì§
- ë„¤ì´í‹°ë¸Œ ë°ì´í„° ì „ì†¡ ì‹œ ë©”ëª¨ë¦¬ ë³µì‚¬ ì—†ìŒ

## ì™œ Rustë¥¼ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?

DartëŠ” GUI ì•± ê°œë°œì— ìµœì í™”ëœ í›Œë¥­í•œ ê°ì²´ì§€í–¥í˜• ì–¸ì–´ì´ì§€ë§Œ, Garbage collectionì„ ë™ì›í•˜ë©° ë„¤ì´í‹°ë¸Œê°€ ì•„ë‹Œ ì–¸ì–´ì´ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ì´ ë¶ˆì¶©ë¶„í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ´ ê²½ìš° Rustë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. Rustì˜ ì„±ëŠ¥ì€ Dartë³´ë‹¤ [ëŒ€ëµ 2~40ë°° ë¹ ë¥´ë‹¤](https://programming-language-benchmarks.vercel.app/dart-vs-rust)ê³  ì•Œë ¤ì ¸ ìˆìœ¼ë©°, Rustì—ì„œëŠ” ë©€í‹°ìŠ¤ë ˆë”©ì„ í™œìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

RustëŠ” Stack Overflowì—ì„œ [ê°€ì¥ ì‚¬ë‘ë°›ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´](https://survey.stackoverflow.co/2022#section-most-loved-dreaded-and-wanted-programming-scripting-and-markup-languages)ë¡œ ì‚¬ë‘ë°›ê³  ìˆìŠµë‹ˆë‹¤. ë¬´ë¹„ìš© ì¶”ìƒí™” ì² í•™ì— ê¸°ë°˜í•œ Rustì˜ ë„¤ì´í‹°ë¸Œ ì„±ëŠ¥ì€ ë†’ì€ ìƒì‚°ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤. ë§ì€ ê°œë°œìë“¤ì´ Rustê°€ ë¯¸ë˜ì— C++ì„ ëŒ€ì²´í•  ê°€ëŠ¥ì„±ì„ ì˜ˆìƒí•˜ê³  ìˆìœ¼ë©°, Rustì˜ ë‹¨ìˆœì„±, ë©”ëª¨ë¦¬ ì•ˆì „ì„±, ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œì˜ ìš°ìˆ˜í•œ ì„±ëŠ¥, í™œê¸°ì°¬ ì»¤ë®¤ë‹ˆí‹°, ê·¸ë¦¬ê³  ê²¬ê³ í•œ ë„êµ¬ ì§€ì›ì´ ì¸ê¸°ë¥¼ ë”ìš± ë†’ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.

Rustì— ëŒ€í•´ ë” ìì„¸íˆ ì•Œê¸° ìœ„í•´ì„  [ê³µì‹ ì„œì ](https://doc.rust-lang.org/book/foreword.html)ì„ ì°¸ê³ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

# ğŸ› ï¸ Rust íˆ´ì²´ì¸ ì„¤ì¹˜í•˜ê¸°

> ì´ ì„¹ì…˜ì€ [Flutter SDK](https://docs.flutter.dev/get-started/install)ê°€ ì‹œìŠ¤í…œì— ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ê³  ê°„ì£¼í•©ë‹ˆë‹¤.

Rust íˆ´ì²´ì¸ ì„¤ì¹˜ëŠ” ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤. [ê³µì‹ ì„¤ì¹˜ í˜ì´ì§€](https://www.rust-lang.org/tools/install)ì˜ ì•ˆë‚´ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

Rust íˆ´ì²´ì¸ ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆë‹¤ë©´, ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”. ë‹¤ì–‘í•œ í”Œë«í¼ì„ ëŒ€ìƒìœ¼ë¡œ ë¹Œë“œí•˜ê¸° ìœ„í•´ Flutter SDKê°€ ì¶”ê°€ì ì¸ ì„¤ì¹˜ë¥¼ ìš”êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í„°ë¯¸ë„ ì¶œë ¥ì— ì•„ë¬´ëŸ° ë¬¸ì œê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.

```bash
rustc --version
flutter doctor
```

# ğŸ‘œ Rust í…œí”Œë¦¿ ì ìš©í•˜ê¸°

> ì´ ì„¹ì…˜ì€ Flutter í”„ë¡œì íŠ¸ê°€ ì¤€ë¹„ë˜ì–´ ìˆë‹¤ê³  ê°„ì£¼í•©ë‹ˆë‹¤. ì•„ì§ Flutter í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ì§€ ì•Šì•˜ë‹¤ë©´, [ê³µì‹ ì•ˆë‚´](https://docs.flutter.dev/get-started/codelab)ë¥¼ ë”°ë¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.

ë¨¼ì €, ì´ íŒ¨í‚¤ì§€ë¥¼ Flutter í”„ë¡œì íŠ¸ì— ì¶”ê°€í•˜ì„¸ìš”.

```bash
flutter pub add rust_in_flutter
```

ê·¸ë¦¬ê³  ë‹¤ìŒ ëª…ë ¹ì„ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.

```bash
dart run rust_in_flutter template
```

ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ê¸°ë³¸ Rust í…œí”Œë¦¿ìœ¼ë¡œì„œì˜ ìƒˆë¡œìš´ íŒŒì¼ê³¼ í´ë”ë“¤ì´ ìƒì„±ë©ë‹ˆë‹¤.

```diff
    my_flutter_project/
    â”œâ”€â”€ android/
    â”œâ”€â”€ ios/
    â”œâ”€â”€ lib/
*   â”‚   â”œâ”€â”€ main.dart
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ linux/
+   â”œâ”€â”€ native/
+   â”‚   â”œâ”€â”€ hub/
+   â”‚   â”‚   â”œâ”€â”€ src/
+   â”‚   â”‚   â””â”€â”€ Cargo.toml
+   â”‚   â”œâ”€â”€ sample_crate/
+   â”‚   â”‚   â”œâ”€â”€ src/
+   â”‚   â”‚   â””â”€â”€ Cargo.toml
+   â”‚   â””â”€â”€ README.md
    â”œâ”€â”€ web/
    â”œâ”€â”€ windows/
*   â”œâ”€â”€ .gitignore
+   â”œâ”€â”€ Cargo.toml
*   â”œâ”€â”€ pubspec.yaml
    â””â”€â”€ ...
```

`./native/README.md` íŒŒì¼ì„ ë°˜ë“œì‹œ ë¨¼ì € ì½ì–´ ë³´ì„¸ìš”. ì‘ë™ êµ¬ì¡°ë¥¼ ì´í•´í•˜ëŠ” ë°ì— í•„ìš”í•œ ì£¼ì„ë“¤ì€ ì½”ë“œ ì•ˆì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì‹¤ì œ ê°œë°œ ì‹œì— `sample_crate`ëŠ” í•„ìš”ì—†ìœ¼ë‹ˆ ì œê±°í•˜ì„¸ìš”. ì‚¬ìš©í•˜ê³  ì‹¶ì€ ê¸°ì¡´ì˜ Rust crateê°€ ìˆë‹¤ë©´ `./native` í´ë”ì— ë„£ê³  `hub` Crateì˜ Dependencyë¡œ ì„¤ì •í•˜ì„¸ìš”.

ì´ì œ `./native/hub/src/lib.rs`ì—ì„œë¶€í„° Rust ì½”ë“œë¥¼ ì‘ì„±í•˜ì‹œë©´ ë©ë‹ˆë‹¤!

# ğŸ‘Ÿ ì‹¤í–‰ ë° ë¹Œë“œ

## ë„¤ì´í‹°ë¸Œ í”Œë«í¼ìš©

ë„¤ì´í‹°ë¸Œ í”Œë«í¼ì—ì„œ ì•±ì„ ì‹¤í–‰í•˜ê³  ë¹Œë“œí•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

ì•±ì„ ì‹¤í–‰í•˜ê¸°:

```bash
flutter run
```

íŠ¹ì • í”Œë«í¼ì„ ìœ„í•´ ì•±ì„ ë¹Œë“œí•˜ê¸°:

```bash
flutter build (platform)  # Replace it with a platform name
```

## ì›¹ìš©

ì›¹ì•±ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ì„  Rustë¡œë¶€í„° WebAssembly ëª¨ë“ˆì„ ìˆ˜ë™ìœ¼ë¡œ ë¹Œë“œí•´ì•¼ í•©ë‹ˆë‹¤. Flutter ì›¹ì•±ì€ ë””ë²„ê·¸ ëª¨ë“œì¼ ë•Œ ìƒë‹¹íˆ ëŠë¦´ ìˆ˜ ìˆë‹¤ê³  ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤.

ì›¹ì•±ì„ ì‹¤í–‰í•˜ê¸°:

```bash
dart run rust_in_flutter wasm
flutter run --profile  # Choose a browser
```

ìµœì í™”ëœ ë°°í¬ ë²„ì „ìœ¼ë¡œ ì›¹ì•±ì„ ë¹Œë“œí•˜ê¸°:

```bash
dart run rust_in_flutter wasm --release
flutter build web
```

# ğŸ§± ì½”ë“œ ì‘ì„±ë²•

## Dartì—ì„œì˜ ìš”ì²­ê³¼ Rustì—ì„œì˜ ì‘ë‹µ

ì•±ì´ ì ì  ì»¤ì§€ë©´ ìƒˆë¡œìš´ Rust API ì—”ë“œí¬ì¸íŠ¸ë“¤ì„ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

Dartì—ì„œ Rustë¡œ ìˆ«ì ë°°ì—´ê³¼ ë¬¸ìì—´ì„ ë³´ë‚´ì–´ ê³„ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ìƒˆë¡œìš´ ë²„íŠ¼ì„ ë§Œë“¤ê³ ì í•œë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. ì´ ê³¼ì •ì„ í•œ ë²ˆ ë”°ë¼í•´ ë³´ë©´ ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ë°©ë²•ì„ ì´í•´í•˜ëŠ” ë°ì— ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.

[ê¸°ë³¸ ì˜ˆì œ](https://github.com/cunarist/rust-in-flutter/tree/main/example)ë¡œë¶€í„° ì‹œì‘í•´ ë´…ì‹œë‹¤. Dartì—ì„œ ì‚¬ìš©ì ì…ë ¥ì„ ë°›ì•„ë“¤ì¼ ë²„íŠ¼ ìœ„ì ¯ì„ ë§Œë“œì„¸ìš”.

```diff
  // lib/main.dart
  ...
  child: Column(
    mainAxisAlignment: MainAxisAlignment.center,
    children: [
+     ElevatedButton(
+       onPressed: () async {},
+       child: Text("Rustë¡œ ìš”ì²­í•˜ê¸°"),
+     ),
  ...
```

`onPressed` í•¨ìˆ˜ëŠ” Rustë¡œ ìš”ì²­ì„ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤. ë¨¼ì € `RustRequest` ê°ì²´ë¥¼ ìƒì„±í•˜ì„¸ìš”.

```diff
  // lib/main.dart
  ...
  import 'package:msgpack_dart/msgpack_dart.dart';
  import 'package:rust_in_flutter/rust_in_flutter.dart';
  ...
  ElevatedButton(
+   onPressed: () async {
+     final rustRequest = RustRequest(
+       address: 'myCategory.someData',
+       operation: RustOperation.Read,
+       bytes: serialize(
+         {
+           'input_numbers': [3, 4, 5],
+           'input_string': 'Zero-cost abstraction',
+         },
+       ),
+     );
+   },
    child: Text("Request to Rust"),
  ),
  ...
```

`address`ëŠ” ì•±ì˜ ê¸°ëŠ¥ì— ë¶€í•©í•˜ëŠ” ì£¼ì†Œë¡œ, ì ìœ¼ë¡œ êµ¬ë¶„ëœ ì¹´ë©œì¼€ì´ìŠ¤(camelCase) ë¬¸ìì—´ë¡œ í‘œí˜„ë©ë‹ˆë‹¤. `operation`ì€ RESTful APIì˜ ì •ì˜ì— ë”°ë¼ create, read, update, delete ì¤‘ í•˜ë‚˜ì˜ ê°’ì„ ê°€ì§‘ë‹ˆë‹¤. `bytes`ëŠ” ë‹¨ìˆœí•œ ë°”ì´íŠ¸ ë°°ì—´ë¡œ, ë³´í†µ [MessagePack](https://msgpack.org/) ì§ë ¬í™” ë°ì´í„°ì…ë‹ˆë‹¤.

ì´ì œ ì´ ìš”ì²­ì„ Rustë¡œ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤. ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” `requestToRust` í•¨ìˆ˜ëŠ” `RustResponse` ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

```diff
  // lib/main.dart
  ...
  import 'package:msgpack_dart/msgpack_dart.dart';
  import 'package:rust_in_flutter/rust_in_flutter.dart';
  ...
  ElevatedButton(
    onPressed: () async {
      final rustRequest = RustRequest(
        address: 'myCategory.someData',
        operation: RustOperation.Read,
        bytes: serialize(
          {
            'input_numbers': [3, 4, 5],
            'input_string': 'Zero-cost abstraction',
          },
        ),
      );
+     final rustResponse = await requestToRust(rustRequest);
    },
    child: Text("Request to Rust"),
  ),
    ...
```

ìš°ë¦¬ì˜ ìƒˆë¡œìš´ API ì£¼ì†ŒëŠ” `myCategory.someData`ì˜€ìŠµë‹ˆë‹¤. Rustì—ì„œ ì´ ì£¼ì†Œë¥¼ ë°›ì•„ë“¤ì´ë„ë¡ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.

```diff
    // native/hub/src/with_request.rs
    ...
    use crate::bridge::api::RustResponse;
    use crate::sample_functions;
    ...
    let layered: Vec<&str> = rust_request.address.split('.').collect();
    let rust_response = if layered.is_empty() {
        RustResponse::default()
    } else if layered[0] == "basicCategory" {
        if layered.len() == 1 {
            RustResponse::default()
        } else if layered[1] == "counterNumber" {
            sample_functions::calculate_something(rust_request).await
        } else {
            RustResponse::default()
        }
+   } else if layered[0] == "myCategory" {
+       if layered.len() == 1 {
+           RustResponse::default()
+       } else if layered[1] == "someData" {
+           sample_functions::some_data(rust_request).await
+       } else {
+           RustResponse::default()
+       }
    } else {
        RustResponse::default()
    };
    ...
```

`sample_functions::some_data`ê°€ ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ë¡œì„œì˜ Rust í•¨ìˆ˜ì…ë‹ˆë‹¤. ì´ ê°„ë‹¨í•œ API ì—”ë“œí¬ì¸íŠ¸ëŠ” ë°°ì—´ì˜ ê° ìš”ì†Œì— 1ì„ ë”í•˜ê³  ë¬¸ìì—´ì˜ ëª¨ë“  ë¬¸ìë¥¼ ëŒ€ë¬¸ìë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤. ë©”ì‹œì§€ ìŠ¤í‚¤ë§ˆëŠ” ì‘ì—… ìœ í˜•ì— ë”°ë¼ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— match ë¬¸ì—ì„œ ì •ì˜ë©ë‹ˆë‹¤.

```diff
    // native/hub/src/sample_functions.rs
    ...
    use crate::bridge::api::RustOperation;
    use crate::bridge::api::RustRequest;
    use crate::bridge::api::RustResponse;
    use rmp_serde::from_slice;
    use rmp_serde::to_vec_named;
    use serde::Deserialize;
    use serde::Serialize;
    ...
+   pub async fn some_data(rust_request: RustRequest) -> RustResponse {
+       match rust_request.operation {
+           RustOperation::Create => RustResponse::default(),
+           RustOperation::Read => {
+               #[allow(dead_code)]
+               #[derive(Deserialize)]
+               struct RustRequestSchema {
+                   input_numbers: Vec<i8>,
+                   input_string: String,
+               }
+               let slice = rust_request.bytes.as_slice();
+               let received: RustRequestSchema = from_slice(slice).unwrap();
+
+               let new_numbers = received.input_numbers.into_iter().map(|x| x + 1).collect();
+               let new_string = received.input_string.to_uppercase();
+
+               #[derive(Serialize)]
+               struct RustResponseSchema {
+                   output_numbers: Vec<i8>,
+                   output_string: String,
+               }
+               RustResponse {
+                   successful: true,
+                   bytes: to_vec_named(&RustResponseSchema {
+                       output_numbers: new_numbers,
+                       output_string: new_string,
+                   })
+                   .unwrap(),
+               }
+           }
+           RustOperation::Update => RustResponse::default(),
+           RustOperation::Delete => RustResponse::default(),
+       }
+   }
    ...
```

ì¢‹ìŠµë‹ˆë‹¤! ì´ì œ Dartì—ì„œ Rustë¡œë¶€í„°ì˜ ì‘ë‹µì„ ë°›ì•˜ì„ ë•Œ, ê·¸ ì•ˆì— ìˆëŠ” ë°”ì´íŠ¸ ë°ì´í„°ë¥¼ ì›í•˜ëŠ” ëŒ€ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```diff
  // lib/main.dart
  ...
  import 'package:msgpack_dart/msgpack_dart.dart';
  import 'package:rust_in_flutter/rust_in_flutter.dart';
  ...
  ElevatedButton(
    onPressed: () async {
      final rustRequest = RustRequest(
        address: 'myCategory.someData',
        operation: RustOperation.Read,
        bytes: serialize(
          {
            'input_numbers': [3, 4, 5],
            'input_string': 'Zero-cost abstraction',
          },
        ),
      );
      final rustResponse = await requestToRust(rustRequest);
+     final message = deserialize(rustResponse.bytes) as Map;
+     print(message["output_numbers"]);
+     print(message["output_string"]);
    },
    child: Text("Request to Rust"),
  ),
    ...
```

ì´ì œ ì½˜ì†”ì— ê²°ê³¼ê°€ ì¶œë ¥ë  ê²ƒì…ë‹ˆë‹¤!

```
flutter: [4, 5, 6]
flutter: ZERO-COST ABSTRACTION
```

ìš°ë¦¬ëŠ” ì—¬ê¸°ì„œ ë‹¨ìˆœíˆ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ëŠ” ê²ƒìœ¼ë¡œ ëëƒˆì§€ë§Œ, ì‹¤ì œ ì•±ì—ì„œëŠ” ì´ ì‘ë‹µ ë°ì´í„°ê°€ Flutter ìœ„ì ¯ì„ ë‹¤ì‹œ ë¹Œë“œí•˜ëŠ” ë°ì— í™œìš©ë  ê²ƒì…ë‹ˆë‹¤.

ì´ëŸ¬í•œ RESTful API íŒ¨í„´ì„ í™•ì¥í•˜ì—¬ í•„ìš”ì— ë”°ë¼ ìˆ˜ë°± ê°œ ë˜ëŠ” ìˆ˜ì²œ ê°œì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›¹ ê°œë°œ ê²½í—˜ì´ ìˆë‹¤ë©´ ì´ ë°©ì‹ì´ ìµìˆ™í•  ê²ƒì…ë‹ˆë‹¤.

## Rustì—ì„œ Dartë¡œì˜ ìŠ¤íŠ¸ë¦¬ë°

Rustì—ì„œ Dartë¡œ ë§¤ ì´ˆë§ˆë‹¤ ì¦ê°€í•˜ëŠ” ìˆ«ìë¥¼ ë³´ë‚´ê³  ì‹¶ë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. ì´ ê²½ìš°, Dartê°€ ë°˜ë³µí•´ì„œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤. ì´ëŸ´ ë•Œ ìŠ¤íŠ¸ë¦¬ë°ì´ í•„ìš”í•©ë‹ˆë‹¤.

[ê¸°ë³¸ ì˜ˆì œ](https://github.com/cunarist/rust-in-flutter/tree/main/example)ë¡œë¶€í„° ì‹œì‘í•´ ë´…ì‹œë‹¤. Rustì—ì„œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ì„¸ìš”.

```diff
    // native/hub/src/lib.rs
    ...
    mod sample_functions;
    ...
    crate::spawn(sample_functions::keep_drawing_mandelbrot());
+   crate::spawn(sample_functions::keep_sending_numbers());
    while let Some(request_unique) = request_receiver.recv().await {
    ...
```

ë§¤ì´ˆë§ˆë‹¤ ìˆ«ìë¥¼ Dartë¡œ ë³´ë‚´ëŠ” ë¹„ë™ê¸° Rust í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì„¸ìš”.

```diff
    // native/hub/src/sample_functions.rs
    ...
    use crate::bridge::api::RustSignal;
    use crate::bridge::send_rust_signal;
    ...
    use rmp_serde::to_vec_named;
    ...
    use serde::Serialize;
    ...
+   pub async fn keep_sending_numbers() {
+       let mut current_number: i32 = 1;
+       loop {
+           crate::time::sleep(std::time::Duration::from_secs(1)).await;
+
+           #[derive(Serialize)]
+           struct RustSignalSchema {
+               current_number: i32,
+           }
+           let rust_signal = RustSignal {
+               address: String::from("myCategory.increasingNumbers"),
+               bytes: to_vec_named(&RustSignalSchema {
+                   current_number: current_number,
+               })
+               .unwrap(),
+           };
+           send_rust_signal(rust_signal);
+           current_number += 1;
+       }
+   }
    ...
```

ë§ˆì§€ë§‰ìœ¼ë¡œ, `StreamBuilder`ë¥¼ ì‚¬ìš©í•˜ì—¬ Dartì—ì„œ ì‹ í˜¸ë¥¼ ë°›ê³ , `where` ë©”ì„œë“œë¡œ ì£¼ì†Œë¥¼ í•„í„°ë§í•˜ê³  ìœ„ì ¯ì„ ë‹¤ì‹œ ë¹Œë“œí•˜ë„ë¡ í•´ ì£¼ì„¸ìš”.

```diff
  // lib/main.dart
  ...
  import 'package:msgpack_dart/msgpack_dart.dart';
  import 'package:rust_in_flutter/rust_in_flutter.dart';
  ...
  children: [
+   StreamBuilder<RustSignal>(
+     stream: rustBroadcaster.stream.where((rustSignal) {
+       return rustSignal.address == "myCategory.increasingNumbers";
+     }),
+     builder: (context, snapshot) {
+       final received = snapshot.data;
+       if (received == null) {
+         return Text("Nothing received yet");
+       } else {
+         final singal = deserialize(received.bytes) as Map;
+         final currentNumber = singal["current_number"] as int;
+         return Text(currentNumber.toString());
+       }
+     },
+   ),
  ...
```

# âœ‹ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)

**Q**. Rustë¥¼ ì–¸ì œ ì‚¬ìš©í•´ì•¼ í•˜ë‚˜ìš”?

**A**. ì´ìƒì ìœ¼ë¡œëŠ” Flutterê°€ í¬ë¡œìŠ¤ í”Œë«í¼ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¥¼ ì²˜ë¦¬í•˜ê³  Rustê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•  ê²ƒì…ë‹ˆë‹¤. í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œëŠ” ì™„ì „íˆ êµ¬ë¶„ë˜ì–´ ìˆìœ¼ë©° Dartì™€ Rust ì½”ë“œëŠ” ì„œë¡œ ë¶„ë¦¬ë˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

**Q**. Dartì™€ Rust ì‚¬ì´ì—ì„œ ë°ì´í„°ëŠ” ì–´ë–»ê²Œ ì „ë‹¬ë˜ë‚˜ìš”?

**A**. Dartì™€ Rust ì‚¬ì´ì—ì„œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë°”ì´íŠ¸ ë°°ì—´ì…ë‹ˆë‹¤. ì´ëŠ” Dartì—ì„œëŠ” `Uint8List`ë¡œ, Rustì—ì„œëŠ” `Vec<u8>`ë¡œ í‘œí˜„ë©ë‹ˆë‹¤. ì¶”ì²œë˜ëŠ” ë©”ì‹œì§€ ì§ë ¬í™” ë°©ì‹ì€ MessagePackì´ì§€ë§Œ, ê³ í•´ìƒë„ ì´ë¯¸ì§€ ë˜ëŠ” íŒŒì¼ ë°ì´í„° ë“± ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ë°”ì´íŠ¸ ë°ì´í„°ë„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë¬´ ì •ë³´ë„ í¬í•¨ì‹œí‚¬ í•„ìš”ê°€ ì—†ë‹¤ë©´ ë¹ˆ ë°”ì´íŠ¸ ë°°ì—´ì„ ë‹´ìœ¼ë©´ ë©ë‹ˆë‹¤.

**Q**. "MessagePack"ì€ ë¬´ì—‡ì´ë©°, ì™œ ê¶Œì¥ë˜ë‚˜ìš”?

**A**. MessagePackì€ JSONê³¼ ìœ ì‚¬í•œ êµ¬ì¡°ì§€ë§Œ, Binaryì´ë©° JSONë³´ë‹¤ ë” ë¹ ë¥´ê³  ë” ì‘ì€ í¬ê¸°ë¥¼ ê°€ì§‘ë‹ˆë‹¤. ë˜í•œ, MessagePackëŠ” JSONì— ë¹„í•´ [ë” ë§ì€ íƒ€ì…](https://github.com/msgpack/msgpack/blob/master/spec.md#type-system)ì„ ì§€ì›í•©ë‹ˆë‹¤. Dartì™€ Rust ê°„ì— ì „ì†¡ë˜ëŠ” ë©”ì‹œì§€ì˜ ì§ë ¬í™”ì—ëŠ” [MessagePack](https://msgpack.org/)ì„ ì‚¬ìš©í•˜ì„¸ìš”. ì´ëŠ” Rust í…œí”Œë¦¿ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ë©°, ë‹¤ë¥¸ ì´ìœ ê°€ ì—†ë‹¤ë©´ MessagePackì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

**Q**. Rust crateë“¤ë¡œë¶€í„° ìƒì„±ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ë“¤ì€ ì–´ë””ì— ìˆë‚˜ìš”?

**A**. Rust-In-Flutterì˜ ë¹Œë“œ ì„¤ì •ì€ Rust crateë“¤ë¡œë¶€í„° ì»´íŒŒì¼ëœ ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ë“¤ì´ ìµœì¢… ë¹Œë“œì— ì˜¬ë°”ë¥´ê²Œ í¬í•¨ë˜ì–´ ë°°í¬ ì¤€ë¹„ê°€ ë˜ì—ˆìŒì„ ë³´ì¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ì„ ë²ˆë“¤ë§í•˜ëŠ” ê²ƒì— ëŒ€í•´ ê±±ì •í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

**Q**. ì•ˆë“œë¡œì´ë“œ ì•±ì„ ë¹Œë“œí•˜ëŠ” ë°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?

**A**. ì•ˆë“œë¡œì´ë“œ ì•±ì„ ë¹Œë“œí•˜ë ¤ë©´ [ì´ ì´ìŠˆ](https://github.com/rust-lang/rust/pull/85806)ë¡œ ì¸í•´ Rust 1.68 ì´ìƒì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ `./android/app/build.gradle` íŒŒì¼ì— `ndkVersion` ë³€ìˆ˜ê°€ ì¡´ì¬í•´ì•¼ í•˜ì§€ë§Œ, í•´ë‹¹ Flutter í”„ë¡œì íŠ¸ë¥¼ Flutter SDK 3.7 ì´í•˜ ë²„ì „ìœ¼ë¡œ ìƒì„±í–ˆë‹¤ë©´ ì´ ë³€ìˆ˜ê°€ ëˆ„ë½ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ [ì´ í† ë¡ ](https://github.com/cunarist/rust-in-flutter/discussions/60)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

**Q**. ë„ì›€ì´ í•„ìš”í•  ë• ì–´ë–»ê²Œ í•˜ë‚˜ìš”?

**A**. ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤ë©´ [í† ë¡  í˜ì´ì§€](https://github.com/cunarist/rust-in-flutter/discussions)ì—ì„œ Q&A ìŠ¤ë ˆë“œë¥¼ ì—´ê³  ë„ì›€ì„ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ì ì¸ ì•ˆë‚´ë¥¼ ì½ê±°ë‚˜ ì†Œí†µì´ í•„ìš”í•  ë• ì´ê³³ì„ ë°©ë¬¸í•´ ì£¼ì„¸ìš”.

**Q**. ë¹„ë™ê¸° ì‘ì—…ë“¤ì€ ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ ì‘ë™í•˜ë‚˜ìš”?

**A**. ë„¤ì´í‹°ë¸Œ í”Œë«í¼ì—ì„œì˜ DartëŠ” ë‹¹ì—°íˆ ë‹¨ì¼ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ë©°, RustëŠ” ë¹„ë™ê¸° ë°©ì‹ì˜ `tokio` ëŸ°íƒ€ì„ì„ í™œìš©í•˜ì—¬ ì»´í“¨í„°ì˜ ëª¨ë“  ì½”ì–´ë¥¼ í™œìš©í•˜ê³ , ë¹„ë™ê¸° ì‘ì—…ë“¤ì´ ê·¸ ëŸ°íƒ€ì„ ë‚´ì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ì›¹ì—ì„œë„ ë§ˆì°¬ê°€ì§€ë¡œ DartëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ì§€ë§Œ, RustëŠ” í•˜ë‚˜ì˜ Web worker(ìŠ¤ë ˆë“œ) ë‚´ì—ì„œë§Œ ì‘ë™í•©ë‹ˆë‹¤. Web workerëŠ” ë©”ëª¨ë¦¬ë¥¼ ê³µìœ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ ì œì•½ì´ ë¶ˆê°€í”¼í•˜ì§€ë§Œ, ê·¸ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œ ë‚´ì—ì„œë‚˜ë§ˆ Rustê°€ ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤ëŠ” ì ì€ ê°™ìœ¼ë©°, ì´ëŠ” Rustì˜ `Future`ë¥¼ JavaScriptì˜ `Promise`ë¡œ ë³€í™˜í•˜ê³  JavaScriptì˜ ì´ë²¤íŠ¸ ë£¨í”„ ì†ìœ¼ë¡œ ì „ë‹¬í•¨ìœ¼ë¡œì¨ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

**Q**. ë©”ì‹œì§€ì— ì–´ë–»ê²Œ ì™„ì „í•œ ì •ì  íƒ€ì…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜ìš”?

**A**. MessagePack ì§ë ¬í™”ë¥¼ ì‚¬ìš©í•˜ë©´, VSCodeì™€ ê°™ì€ IDEì˜ ì¸í…”ë¦¬ì„¼ìŠ¤ë¡œë¶€í„° ì™„ë²½í•œ ì§€ì›ì„ ë°›ê¸°ëŠ” í˜ë“¤ ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì ì¬ì ì¸ íƒ€ì… ê´€ë ¨ ë¬¸ì œë¥¼ ì•¼ê¸°í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. IDEì˜ ì™„ì „í•œ íƒ€ì… ê²€ì‚¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  MessagePack ëŒ€ì‹  Protobufë¥¼ ì„ íƒí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ProtobufëŠ” ë°ì´í„° íƒ€ì… ê´€ë ¨ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ëŠ” ì •ì  íƒ€ì…ì˜ ì§ë ¬í™” ë°©ì‹ì…ë‹ˆë‹¤. Protobufë¥¼ í†µí•©í•˜ëŠ” ë°©ë²•ì€ ì´ íŒ¨í‚¤ì§€ì˜ ì§€ì› ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë¯€ë¡œ, [ê³µì‹ ë¬¸ì„œ](https://protobuf.dev/)ë¥¼ ì°¸ì¡°í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

**Q**. ë¹Œë“œëœ ì›¹ ë²„ì „ì„ ì‹¤í–‰í•˜ë©´ ë¸Œë¼ìš°ì €ì— Cross origin policyì™€ ê´€ë ¨ëœ ì˜¤ë¥˜ê°€ í‘œì‹œë©ë‹ˆë‹¤.

**A**. ì›¹ì•±ì„ ë¹Œë“œí•˜ê³  ë°°í¬í•˜ê¸° ìœ„í•´ì„ , ì›¹ ì„œë²„ê°€ Cross-originê³¼ ê´€ë ¨ëœ HTTP headerë“¤ì„ ì‘ë‹µì— í¬í•¨ì‹œí‚¤ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤. `cross-origin-opener-policy`ì˜ ê°’ì„ `same-origin`ë¡œ, `cross-origin-embedder-policy`ë¥¼ `require-corp` ë˜ëŠ” `credentialless`ë¡œ ì„¤ì •í•˜ì„¸ìš”. ì´ HTTP headerë“¤ì„ ì„¤ì •í•´ì•¼ í•´ë‹¹ ì›¹ì‚¬ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì´ í”„ë ˆì„ì›Œí¬ì— í•„ìš”í•œ `SharedArrayBuffer` ì›¹ APIì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `SharedArrayBuffer`ëŠ” ì›¹ì—ì„œ ê³µìœ  ë©”ëª¨ë¦¬ì™€ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

**Q**. Rust ì½”ë“œê°€ ë³€ê²½ë˜ë©´ Dartì˜ Hot restartì— ì ìš©ë˜ë‚˜ìš”?

**A**. ì•„ë‹ˆìš”, ì—…ë°ì´íŠ¸ëœ Rust ì½”ë“œëŠ” Dartì˜ Hot restart ì‹œì— ë¡œë”©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë³€ê²½ì‚¬í•­ì„ ì ìš©í•˜ë ¤ë©´ ì•±ì„ ë‹¤ì‹œ ì»´íŒŒì¼í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ìƒˆë¡œ ì»´íŒŒì¼ëœ Rust ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒŒì¼ê³¼ ì•± ë°”ì´ë„ˆë¦¬ë¥¼ ë‹¤ì‹œ ì—°ê²°í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ ì œì•½ì€ Hot restartë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ëŸ¬ìŠ¤íŠ¸ì˜ ì»´íŒŒì¼ ë°©ì‹ìœ¼ë¡œë¶€í„° ë¹„ë¡¯ë©ë‹ˆë‹¤. ê·¸ë ‡ì§€ë§Œ Dartì˜ Hot restartê°€ Rust ë¡œì§, ì¦‰ `main()` í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ëŠ” ê²ƒì€ ë§ìŠµë‹ˆë‹¤.

# ğŸŒŸ ê¸°ì—¬ìë“¤

ì´ í”„ë¡œì íŠ¸ì˜ ê°œë°œì„ ë„ì™€ì£¼ì‹  ê²ƒì— ê°ì‚¬ë“œë¦½ë‹ˆë‹¤!

[![GitHub ê¸°ì—¬ì ëª©ë¡ (allcontributors.org í†µí•´ì„œ)](https://contrib.rocks/image?repo=cunarist/rust-in-flutter)](https://github.com/cunarist/rust-in-flutter/graphs/contributors)

# â˜• ê°œë°œ ì§€ì›í•˜ê¸°

ğŸ˜‰ Rust-In-Flutterì˜ ê¸°ëŠ¥ì´ ë„ì›€ì´ ë˜ì—ˆë‹¤ë©´, ì´ í”„ë¡œì íŠ¸ë¥¼ ì§€ì›í•´ì£¼ì„¸ìš”. ì—¬ëŸ¬ë¶„ì˜ ë„ˆê·¸ëŸ¬ìš´ í›„ì›ì€ Rust-In-Flutterì˜ ìœ ì§€ë³´ìˆ˜ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤.

ë§Œì•½ ì§€ì›í•´ ì£¼ì‹œê¸°ë¡œ ê²°ì •í–ˆë‹¤ë©´, [Buy Me a Coffee í˜ì´ì§€](https://www.buymeacoffee.com/cunarist)ë¡œ ì°¾ì•„ì™€ ì£¼ì„¸ìš”.
