> ì˜ì–´ ì´ì™¸ì˜ ì–¸ì–´ë¡œ ëœ ë¬¸ì„œì—ì„œëŠ” ë¬¸ì¥ì´ ì–´ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¸ì„œ ê°œì„ ì— ê¸°ì—¬í•˜ê³  ì‹¶ìœ¼ì‹  ë¶„ì€ [Pull request](https://github.com/cunarist/rust-in-flutter/pulls)ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”. ì–¸ì œë‚˜ ë„ì›€ì— ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.

# ğŸ† Rust-In-Flutter

Rustë¥¼ í™œìš©í•´ì„œ Flutter ì•±ì˜ ì†ë„ë¥¼ ê·¹ì ìœ¼ë¡œ í–¥ìƒì‹œì¼œ ë³´ì„¸ìš”!

![preview](https://github.com/cunarist/rust-in-flutter/assets/66480156/be85cf04-2240-497f-8d0d-803c40536d8e)

ì´ ê°„ë‹¨í•œ í”„ë ˆì„ì›Œí¬ëŠ” ê°€ë²¼ìš°ë©´ì„œ ì‚¬ìš©í•˜ê¸° ì‰½ê³ , í™•ì¥ì„± ë° ì„±ëŠ¥ì„ ëª¨ë‘ ê³ ë ¤í•˜ì—¬ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  ë³µì¡í•œ ì‘ì—…ì€ ìë™ìœ¼ë¡œ ë‚´ë¶€ì ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. Flutter í”„ë¡œì íŠ¸ì— ì´ íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€í•˜ê¸°ë§Œ í•˜ë©´ Rustë¥¼ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì´ì 

- Rustë¥¼ í†µí•©í•˜ê³  ì›í•˜ëŠ” ë§Œí¼ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ Crateë¥¼ ì‚¬ìš© ê°€ëŠ¥í•¨
- ê¸°ì¡´ì˜ Rust Crateë„ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥í•¨
- CMake, Gradle, Podfile ë“±ê³¼ ê°™ì€ ë¯¼ê°í•œ ë¹Œë“œ íŒŒì¼ì„ ê±´ë“œë¦´ í•„ìš”ê°€ ì—†ìŒ
- ë³µì¡í•œ ì½”ë“œ ìƒì„± ì ˆì°¨ê°€ ì—†ìŒ
- ë³„ë‹¤ë¥¸ ë…¸ë ¥ ì—†ì´ ì›í•˜ëŠ” ë§Œí¼ì˜ RESTful API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŒ
- ì•„ì£¼ ì‰¬ìš´ Dartë¡œë¶€í„°ì˜ ìš”ì²­ê³¼ Rustë¡œë¶€í„°ì˜ Async ì‘ë‹µ
- Rustì—ì„œ Dartë¡œì˜ ìŠ¤íŠ¸ë¦¬ë°
- Dartì˜ Hot restart ì‹œ ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë˜ëŠ” Rust ë¡œì§
- ìµœì†Œí•œì˜ ì˜¤ë²„í—¤ë“œ
- ë„¤ì´í‹°ë¸Œ ë°ì´í„° ì „ì†¡ ì‹œ ë©”ëª¨ë¦¬ ë³µì‚¬ ì—†ìŒ

## í”Œë«í¼ ì§€ì›

ì´ íŒ¨í‚¤ì§€ëŠ” ì–´ë ¤ìš´ ë¹Œë“œ ì„¤ì •ë“¤ì„ ëª¨ë‘ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ ì¤ë‹ˆë‹¤. ì‘ì—… ì¤‘ì¸ Flutter ì•± í”„ë¡œì íŠ¸ì˜ íŒŒì¼ì—ëŠ” ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

- âœ… Linux: ì§€ì› ë° ì‘ë™ í™•ì¸ë¨
- âœ… Android: ì§€ì› ë° ì‘ë™ í™•ì¸ë¨
- âœ… Windows: ì§€ì› ë° ì‘ë™ í™•ì¸ë¨
- âœ… macOS: ì§€ì› ë° ì‘ë™ í™•ì¸ë¨
- âœ… iOS: ì§€ì› ë° ì‘ë™ í™•ì¸ë¨
- â¸ï¸ Web: í˜„ì¬ëŠ” ë¯¸ì§€ì›ì´ë‚˜ [ê³ ë ¤ ì¤‘](https://github.com/cunarist/rust-in-flutter/issues/34)

> ì œì•ˆ ì‚¬í•­ì´ë‚˜ ë²„ê·¸ë¥¼ ì‹ ê³ í•  ë•Œì—ëŠ” [Issue](https://github.com/cunarist/rust-in-flutter/issues) ë˜ëŠ” [Pull request](https://github.com/cunarist/rust-in-flutter/pulls)ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. ê°€ëŠ¥í•œ í•œ ë¹ ë¥´ê²Œ ë‹µë³€í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

## ì™œ ëŸ¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?

DartëŠ” í›Œë¥­í•œ ê°ì²´ì§€í–¥í˜• ëª¨ë˜ ì–¸ì–´ì´ì§€ë§Œ Garbage collectionì„ ë™ì›í•˜ë©° ë„¤ì´í‹°ë¸Œê°€ ì•„ë‹Œ ì–¸ì–´ì´ê¸° ë•Œë¬¸ì— ì‘ë™ ì„±ëŠ¥ì´ ìš”êµ¬ ì‚¬í•­ì„ ë§Œì¡±ì‹œí‚¤ì§€ ëª»í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ê²½ìš° Rustê°€ í•„ìš”í•´ì§‘ë‹ˆë‹¤. Rustì˜ ì„±ëŠ¥ì€ Dartë³´ë‹¤ [ëŒ€ëµ 2~40ë°° ë¹ ë¥´ë‹¤](https://programming-language-benchmarks.vercel.app/dart-vs-rust)ê³  ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤. RustëŠ” ë©€í‹°ìŠ¤ë ˆë”© í™œìš©í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ë„ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤.

# ğŸ‘œ ì»´í¬ë„ŒíŠ¸ ì„¤ì¹˜

ìš°ì„ , ì´ íŒ¨í‚¤ì§€ë¥¼ Flutter í”„ë¡œì íŠ¸ì— ì¶”ê°€í•˜ì„¸ìš”.

```bash
flutter pub add rust_in_flutter
```

ê·¸ë¦¬ê³  Rust toolchainì„ ì„¤ì¹˜í•˜ì„¸ìš”. [ê³µì‹ Rust ë¬¸ì„œ](https://doc.rust-lang.org/book/ch01-01-installation.html)ì— ìì„¸í•œ ì„¤ëª…ì´ ë‚˜ì™€ ìˆìŠµë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹œìŠ¤í…œì´ ì»´íŒŒì¼í•  ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”. ê° ì„¤ì¹˜ ë‹¨ê³„ í›„ ì‹œìŠ¤í…œ ìƒíƒœë¥¼ í™•ì¸í•˜ë ¤ë©´ ì´ ëª…ë ¹ë“¤ì„ ë°˜ë³µí•´ì„œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤. í„°ë¯¸ë„ ì¶œë ¥ì— ì•„ë¬´ëŸ° ë¬¸ì œê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.

```bash
rustc --version
flutter doctor
```

> Rustë¡œ ë‹¤ì–‘í•œ ë¹Œë“œ íƒ€ê²Ÿì„ ì‚¬ìš©í•˜ë©´ ë•Œë¡œ ì˜ˆìƒì¹˜ ëª»í•œ ë¬¸ì œê°€ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¸ì œê°€ ë°œìƒí•˜ë©´ [í† ë¡  í˜ì´ì§€](https://github.com/cunarist/rust-in-flutter/discussions)ì—ì„œ Q&A ìŠ¤ë ˆë“œë¥¼ ì—´ì–´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

# ğŸ‘œ í…œí”Œë¦¿ ì ìš©

í”ŒëŸ¬í„° í”„ë¡œì íŠ¸ í´ë”ì—ì„œ ëª…ë ¹ì¤„ì—ì„œ ë‹¤ìŒì„ ì‹¤í–‰í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

```bash
dart run rust_in_flutter:apply_template
```

ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ê¸°ë³¸ Rust í…œí”Œë¦¿ìœ¼ë¡œì„œì˜ ìƒˆë¡œìš´ íŒŒì¼ê³¼ í´ë”ë“¤ì´ ìƒì„±ë©ë‹ˆë‹¤.

```diff
    my_flutter_project/
    â”œâ”€â”€ android/
    â”œâ”€â”€ ios/
    â”œâ”€â”€ lib/
*   â”‚   â”œâ”€â”€ main.dart
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ linux/
+   â”œâ”€â”€ native/
+   â”‚   â”œâ”€â”€ hub/
+   â”‚   â”‚   â”œâ”€â”€ src/
+   â”‚   â”‚   â””â”€â”€ Cargo.toml
+   â”‚   â”œâ”€â”€ sample_crate/
+   â”‚   â”‚   â”œâ”€â”€ src/
+   â”‚   â”‚   â””â”€â”€ Cargo.toml
+   â”‚   â””â”€â”€ README.md
    â”œâ”€â”€ web/
    â”œâ”€â”€ windows/
*   â”œâ”€â”€ .gitignore
+   â”œâ”€â”€ Cargo.toml
*   â”œâ”€â”€ pubspec.yaml
    â””â”€â”€ ...
```

`./native/README.md` íŒŒì¼ì„ ë°˜ë“œì‹œ ë¨¼ì € ì½ì–´ ë³´ì„¸ìš”. ë˜í•œ ì‹¤ì œ ê°œë°œ ì‹œì— `sample_crate`ëŠ” í•„ìš”ì—†ìœ¼ë‹ˆ ì œê±°í•˜ì„¸ìš”. ì´ë¯¸ ë§Œë“¤ì–´ ë†“ì•˜ë˜ Rust crateê°€ ìˆë‹¤ë©´ `./native` í´ë”ì— ë„£ê³  `hub` Crateì˜ Dependencyë¡œ ì„¤ì •í•˜ì„¸ìš”.

ì´ì œ `./native/hub/src/lib.rs`ì—ì„œ Rust ì½”ë”©ì„ ì‹œì‘í•˜ì‹œë©´ ë©ë‹ˆë‹¤!

# ğŸ§± ì½”ë“œ ì‘ì„±ë²•

Dartì—ì„œ ìš”ì²­í•  ë•Œì—ëŠ” ì‘ì—… ë° ì£¼ì†Œë¥¼ í•¨ê»˜ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. ìƒí˜¸ì‘ìš© ë°©ì‹ì€ RESTful APIì˜ ì •ì˜ì— ë¶€í•©í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

```dart
import 'package:msgpack_dart/msgpack_dart.dart';
import 'package:rust_in_flutter/rust_in_flutter.dart';

void someFunction() async {
    var rustRequest = RustRequest(
      address: 'basicCategory.counterNumber',
      operation: RustOperation.Read,
      bytes: serialize(
        {
          'letter': 'Hello from Dart!',
          'before_number': 888,
          'dummy_one': 1,
          'dummy_two': 2,
          'dummy_three': [3, 4, 5]
        },
      ),
    );

    var rustResponse = await requestToRust(rustRequest);
    var message = deserialize(rustResponse.bytes) as Map;
    var innerValue = message['after_number'] as int;
}
```

ëŸ¬ìŠ¤íŠ¸ì—ì„œ ìš”ì²­ì„ ìˆ˜ì‹ í•˜ë©´ ë¨¼ì € ì£¼ì†Œë³„ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”.

```rust
pub async fn handle_request(request_unique: RustRequestUnique) -> RustResponseUnique {
    let rust_request = request_unique.request;
    let interaction_id = request_unique.id;

    let layered: Vec<&str> = rust_request.address.split('.').collect();
    let rust_response = if layered.is_empty() {
        RustResponse::default()
    } else if layered[0] == "basicCategory" {
        if layered.len() == 1 {
            RustResponse::default()
        } else if layered[1] == "counterNumber" {
            sample_functions::calculate_something(rust_request).await
        } else {
            RustResponse::default()
        }
    } else {
        RustResponse::default()
    };

    RustResponseUnique {
        id: interaction_id,
        response: rust_response,
    }
}
```

Rustì—ì„œì˜ ì—”ë“œí¬ì¸íŠ¸ í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ë©”ì‹œì§€ SchemaëŠ” ì‘ì—… ìœ í˜•ì— ë”°ë¼ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— Match êµ¬ë¬¸ ë‚´ì—ì„œ ì •ì˜ë˜ë„ë¡ ì“°ì—¬ ìˆìŠµë‹ˆë‹¤.

```rust
pub async fn calculate_something(rust_request: RustRequest) -> RustResponse {
    match rust_request.operation {
        RustOperation::Create => RustResponse::default(),
        RustOperation::Read => {
            #[allow(dead_code)]
            #[derive(Deserialize)]
            struct RustRequestSchema {
                letter: String,
                before_number: i32,
                dummy_one: i32,
                dummy_two: i32,
                dummy_three: Vec<i32>,
            }
            let slice = rust_request.bytes.as_slice();
            let received: RustRequestSchema = from_slice(slice).unwrap();
            println!("{:?}", received.letter);

            let before_value = received.before_number;
            let after_value = sample_crate::add_seven(before_value);

            #[derive(Serialize)]
            struct RustResponseSchema {
                after_number: i32,
                dummy_one: i32,
                dummy_two: i32,
                dummy_three: Vec<i32>,
            }
            RustResponse {
                successful: true,
                bytes: to_vec_named(&RustResponseSchema {
                    after_number: after_value,
                    dummy_one: 1,
                    dummy_two: 2,
                    dummy_three: vec![3, 4, 5],
                })
                .unwrap(),
            }
        }
        RustOperation::Update => RustResponse::default(),
        RustOperation::Delete => RustResponse::default(),
    }
}
```

ì´ RESTful API íŒ¨í„´ì„ í™•ì¥í•˜ì—¬ í•„ìš”ì— ë”°ë¼ ìˆ˜ë°±, ìˆ˜ì²œ ê°œì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›¹ ê°œë°œì„ í•œ ê²½í—˜ì´ ìˆë‹¤ë©´ ì´ ë°©ì‹ì€ ì´ë¯¸ ìµìˆ™í•  ê²ƒì…ë‹ˆë‹¤. Rust í…œí”Œë¦¿ ë‚´ë¶€ì˜ ì‹¤ì œ ì½”ë“œì— ë” ë§ì€ ì£¼ì„ê³¼ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ì´ìƒì ìœ¼ë¡œ FlutterëŠ” í¬ë¡œìŠ¤ í”Œë«í¼ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¥¼ ì²˜ë¦¬í•˜ê³  Rustê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•  ê²ƒì…ë‹ˆë‹¤. í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œëŠ” ì™„ì „íˆ êµ¬ë¶„ë˜ì–´ ìˆìœ¼ì–´ ìˆìœ¼ë©° Dartì™€ Rust ì½”ë“œëŠ” ì„œë¡œ ë¶„ë¦¬ë˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. í†µì‹ ì€ ì±„ë„ê³¼ ìŠ¤íŠ¸ë¦¼ì„ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

Dartì™€ Rust ê°„ì— ì „ì†¡ë˜ëŠ” ë©”ì‹œì§€ì˜ ì§ë ¬í™”ì—ëŠ” [MessagePack](https://msgpack.org/)ì„ ì‚¬ìš©í•˜ì„¸ìš”. ì´ëŠ” Rust í…œí”Œë¦¿ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ë©°, ë‹¤ë¥¸ ì´ìœ ê°€ ì—†ë‹¤ë©´ MessagePackì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. MessagePackì€ JSONê³¼ ìœ ì‚¬í•œ êµ¬ì¡°ì§€ë§Œ, Binaryì´ë©° JSONë³´ë‹¤ ë” ë¹ ë¥´ê³  ë” ì‘ì€ í¬ê¸°ë¥¼ ê°€ì§‘ë‹ˆë‹¤.

Dartì™€ Rust ì‚¬ì´ì—ì„œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë°”ì´íŠ¸ ë°°ì—´ë¡œ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. Dartì—ì„œëŠ” `Uint8List`ë¡œ, Rustì—ì„œëŠ” `Vec<u8>`ë¡œ í‘œí˜„ë©ë‹ˆë‹¤. ì¶”ì²œë˜ëŠ” ë©”ì‹œì§€ ì§ë ¬í™” ë°©ì‹ì€ MessagePackì´ì§€ë§Œ, ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ë°”ì´íŠ¸ ë°ì´í„°(ê³ í•´ìƒë„ ì´ë¯¸ì§€ ë˜ëŠ” íŒŒì¼ ë°ì´í„° ë“±)ë„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë¬´ ì •ë³´ë„ í¬í•¨ì‹œí‚¬ í•„ìš”ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°”ì´íŠ¸ ë°°ì—´ì„ ë‹´ìœ¼ë©´ ë©ë‹ˆë‹¤.

# â˜• ê°œë°œ ì§€ì›í•˜ê¸°

ğŸ˜‰ Rust-In=Flutterì˜ ê¸°ëŠ¥ì´ ë„ì›€ì´ ë˜ì—ˆë‹¤ë©´, ì´ í”„ë¡œì íŠ¸ë¥¼ ì§€ì›í•´ì£¼ì„¸ìš”. ì—¬ëŸ¬ë¶„ì˜ ë„ˆê·¸ëŸ¬ìš´ í›„ì›ì€ Rust-In-Flutterì˜ ìœ ì§€ë³´ìˆ˜ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤.

ë§Œì•½ ì§€ì›í•´ ì£¼ì‹œê¸°ë¡œ ê²°ì •í–ˆë‹¤ë©´, [Buy me a coffee](https://www.buymeacoffee.com/cunarist)ë¡œ ì°¾ì•„ì™€ ì£¼ì„¸ìš”.
